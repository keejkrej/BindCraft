# BindCraft GUI Development Plan

## 1. Vision and Goals

The goal is to create an intuitive, all-in-one desktop application for BindCraft using PySide6. This GUI will abstract away the complexities of command-line usage and manual JSON editing, making the powerful binder design pipeline accessible to a broader scientific audience. The application will provide an interactive and visual workflow, from target setup to results analysis, leveraging the local high-performance GPU.

## 2. Tech Stack

*   **GUI Framework:** **PySide6** (Qt for Python) for the core application structure, widgets, and event handling.
*   **Backend Logic:** The existing **BindCraft Python scripts** will be used as the backend engine. The GUI will act as a frontend controller for the pipeline.
*   **3D Visualization:** **PyVista**. It integrates smoothly with Qt and is excellent for rendering molecular structures from PDB files.
*   **2D Plotting:** **PyQtGraph**. It is a high-performance plotting library specifically designed for Qt applications, ideal for displaying the various statistical plots generated by the pipeline.
*   **Concurrency:** **QThread** for running the long BindCraft pipeline in a background thread to keep the GUI responsive.
*   **Packaging:** **PyInstaller** to bundle the application, Python interpreter, and all dependencies into a single, standalone executable for easy distribution.

## 3. Core GUI Components and Layout

The main window will be a `QMainWindow` divided into three primary sections, providing a logical flow from configuration to results.

---

### **Component 1: Configuration Panel (Left Pane)**

This will be a `QTabWidget` to organize all user-configurable settings.

*   **Tab A: Target Setup**
    *   **PDB Loader:** A "Load Target PDB" button (`QPushButton`) that opens a file dialog.
    *   **3D Viewer:** A PyVista rendering widget to display the loaded target protein.
        *   *Feature:* Allow users to click on residues in the 3D view to automatically populate the "Hotspot Residues" field.
    *   **Input Fields (`QLineEdit`):**
        *   Binder Name
        *   Target Chains (e.g., "A")
        *   Target Hotspot Residues (e.g., "24,25,26")

*   **Tab B: Design Parameters**
    *   **Binder Length:** A range slider or two `QSpinBox` widgets for min/max length.
    *   **Advanced Settings:** A dropdown (`QComboBox`) to select the advanced settings profile (e.g., `default_4stage_multimer`).
    *   **MPNN Options:** Checkboxes (`QCheckBox`) for "Enable ProteinMPNN Redesign" and "Save MPNN FASTA files".
    *   **Trajectory Count:** `QSpinBox` widgets for "Target Accepted Designs" and "Max Trajectories".

*   **Tab C: Filter Settings**
    *   **Profile Management:** "Load Filters" and "Save Filters" buttons to manage `filters.json` profiles.
    *   **Filter Table:** A `QTableWidget` that dynamically displays the filter parameters (e.g., `pLDDT`, `dSASA`, `ShapeComplementarity`). Each row will have the parameter name and a `QLineEdit` or `QSpinBox` to set its threshold value.

---

### **Component 2: Run Management & Logs (Center-Top Pane)**

This section will control the pipeline execution and display its status.

*   **Run Control:** A "Start Run" button that changes to a "Stop Run" button during execution.
*   **Progress Bar:** A `QProgressBar` to show the percentage of completed trajectories relative to the "Max Trajectories" setting.
*   **Log Viewer:** A read-only `QTextEdit` that displays the real-time console output from the BindCraft script, providing detailed status updates.

---

### **Component 3: Results & Visualization (Center-Bottom Pane)**

This will be a `QTabWidget` for interactive exploration of the results.

*   **Tab A: Accepted Designs (Results Table)**
    *   A `QTableWidget` that is populated in real-time as designs pass the filters.
    *   Columns will correspond to the `final_design_stats.csv` file (Name, pLDDT, dG, etc.).
    *   *Feature:* The table will be sortable by clicking on column headers.

*   **Tab B: 3D Structure Viewer**
    *   A second PyVista rendering widget.
    *   When a user selects a design in the "Results Table", this view will automatically load and display the 3D structure of that binder-target complex.
    *   *Feature:* Options to color by pLDDT, highlight the interface, etc.

*   **Tab C: Analytics Plots**
    *   A PyQtGraph widget.
    *   When a user selects a design, this widget will find and display the associated PNG plots (PAE, pLDDT, contact map) from the output directory.

## 4. Backend Integration and Workflow

1.  **Initialization:** On launch, the GUI reads the default JSON setting files to populate the fields in the Configuration Panel.
2.  **Execution:**
    *   When the user clicks "Start Run", the GUI gathers all settings from the input fields.
    *   It creates temporary `settings.json`, `filters.json`, and `advanced.json` files for the run.
    *   A **`QThread` worker** is instantiated and started. This worker's job is to execute the main BindCraft pipeline function in the background.
    *   The GUI passes the paths to the temporary JSON files to the worker.
3.  **Communication:**
    *   The worker thread uses **PySide6 signals** to communicate back to the main GUI thread without freezing it.
    *   `signal_log_message(str)`: Sends a line of output to the Log Viewer.
    *   `signal_progress_update(int)`: Updates the progress bar.
    *   `signal_design_accepted(dict)`: Sends a dictionary of a new accepted design's stats, which the main thread then adds as a new row to the Results Table.
    *   `signal_run_finished()`: Notifies the GUI that the process is complete, re-enabling the "Start Run" button.
4.  **Interaction:** The main GUI thread listens for these signals and updates the UI components accordingly. It also listens for user actions, like clicking a row in the results table, to trigger updates in the 3D viewer and plot tabs.
